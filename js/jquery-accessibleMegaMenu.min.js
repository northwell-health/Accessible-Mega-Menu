!function($,e,t){"use strict";function s(e,t){this.element=e,this.settings=$.extend({},l,t),this._defaults=l,this._name=n,this.mouseTimeoutID=null,this.focusTimeoutID=null,this.mouseFocused=!1,this.justFocused=!1,this.init()}function a(e){return $.expr.filters.visible(e)&&!$(e).parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length}function i(e,t){var s,i,n,l=e.nodeName.toLowerCase();return"area"===l?(s=e.parentNode,i=s.name,e.href&&i&&"map"===s.nodeName.toLowerCase()?(n=$("img[usemap=#"+i+"]")[0],!!n&&a(n)):!1):(/input|select|textarea|button|object/.test(l)?!e.disabled:"a"===l?e.href||t:t)&&a(e)}var n="accessibleMegaMenu",l={uuidPrefix:"accessible-megamenu",menuSelector:"> *:first",menuClass:"accessible-megamenu",topNavItemClass:"accessible-megamenu-top-nav-item",panelClass:"accessible-megamenu-panel",panelGroupClass:"accessible-megamenu-panel-group",hoverClass:"hover",focusClass:"focus",openClass:"open",tapEvent:"touchstart"},o={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38,keyMap:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",190:"."}};s.prototype=function(){var a=0,i=1e3,l="",r="function"==typeof e.hasOwnProperty&&!!e.hasOwnProperty("ontouchstart"),u,c,f,h,d,p,m,g,b,C,v,x,y;return u=function(e){return $(e).closest(":data(plugin_"+n+")").data("plugin_"+n)},c=function(e){e=$(e);var t=this.settings;e.attr("id")||e.attr("id",t.uuidPrefix+"-"+(new Date).getTime()+"-"+ ++a)},f=function(e,s){var a=$(e.target),i=this,n=this.settings,l=this.menu,r=a.closest("."+n.topNavItemClass),u=a.hasClass(n.panelClass)?a:a.closest("."+n.panelClass),c;if(r.length||(r=l.find("."+n.topNavItemClass+"."+n.openClass)),y.call(this,!0),s)if(r.removeClass(n.openClass),r=l.find("."+n.topNavItemClass+" ."+n.openClass+":first").closest("."+n.topNavItemClass),r.is(e.relatedTarget)||r.has(e.relatedTarget).length>0)0===r.length&&l.find("[aria-expanded=true]").attr("aria-expanded","false").removeClass(n.openClass).filter("."+n.panelClass).attr("aria-hidden","true");else{if(("mouseout"===e.type||"focusout"===e.type)&&r.has(t.activeElement).length>0)return;r.find("[aria-expanded]").attr("aria-expanded","false").removeClass(n.openClass).filter("."+n.panelClass).attr("aria-hidden","true"),("keydown"===e.type&&e.keyCode===o.ESCAPE||"DOMAttrModified"===e.type)&&(c=r.find(":tabbable:first"),setTimeout(function(){l.find("[aria-expanded]."+i.settings.panelClass).off("DOMAttrModified.accessible-megamenu"),c.focus(),i.justFocused=!1},99))}else clearTimeout(i.focusTimeoutID),l.find("."+n.topNavItemClass+"."+n.openClass).not(r).removeClass(n.openClass),r.siblings().find("[aria-expanded]").attr("aria-expanded","false").removeClass(n.openClass).filter("."+n.panelClass).attr("aria-hidden","true"),r.find("[aria-expanded]").attr("aria-expanded","true").addClass(n.openClass).filter("."+n.panelClass).attr("aria-hidden","false"),r.addClass(n.openClass),"mouseover"===e.type&&a.is(":tabbable")&&1===r.length&&0===u.length&&l.has(t.activeElement).length>0&&(a.focus(),i.justFocused=!1),y.call(i)},h=function(e){var t=$(e.currentTarget),s=t.closest("."+this.settings.topNavItemClass),a=t.closest("."+this.settings.panelClass);s.length||a.length||(t=$(e.target),s=t.closest("."+this.settings.topNavItemClass),a=t.closest("."+this.settings.panelClass)),1===s.length&&0===a.length&&1===s.find("."+this.settings.panelClass).length&&(clearTimeout(this.focusTimeoutID),t.hasClass(this.settings.openClass)||s.hasClass(this.settings.openClass)?this.justFocused?(e.preventDefault(),e.stopPropagation(),this.justFocused=!1):r&&(e.preventDefault(),e.stopPropagation(),f.call(this,e,t.hasClass(this.settings.openClass)||s.hasClass(this.settings.openClass))):(e.preventDefault(),e.stopPropagation(),f.call(this,e),this.justFocused=!1))},d=function(e){clearTimeout(this.focusTimeoutID),0===$(e.target).closest(this.menu).length&&(e.preventDefault(),e.stopPropagation(),f.call(this,e,!0))},p=function(e){"aria-expanded"===e.originalEvent.attrName&&"false"===e.originalEvent.newValue&&$(e.target).hasClass(this.settings.openClass)&&(e.preventDefault(),e.stopPropagation(),f.call(this,e,!0))},m=function(e){clearTimeout(this.focusTimeoutID);var t=$(e.target),s=t.closest("."+this.settings.panelClass);t.addClass(this.settings.focusClass).on("click.accessible-megamenu",$.proxy(h,this)),this.justFocused=!this.mouseFocused,this.mouseFocused=!1,this.panels.not(s).filter("."+this.settings.openClass).length&&f.call(this,e)},g=function(t){this.justFocused=!1;var s=this,a=$(t.target),i=a.closest("."+this.settings.topNavItemClass),n=!1;a.removeClass(this.settings.focusClass).off("click.accessible-megamenu"),e.cvox?s.focusTimeoutID=setTimeout(function(){e.cvox.Api.getCurrentNode(function(e){i.has(e).length?clearTimeout(s.focusTimeoutID):s.focusTimeoutID=setTimeout(function(e,t,s){f.call(e,t,s)},275,s,t,!0)})},25):s.focusTimeoutID=setTimeout(function(){f.call(s,t,!0)},300)},b=function(t){var a=this.constructor===s?this:u(this),n=a.settings,r=$($(this).is("."+n.hoverClass+":tabbable")?this:t.target),c=a.menu,d=a.topnavitems,p=r.closest("."+n.topNavItemClass),m=c.find(":tabbable"),g=r.hasClass(n.panelClass)?r:r.closest("."+n.panelClass),b=g.find("."+n.panelGroupClass),C=r.closest("."+n.panelGroupClass),v,x=t.keyCode||t.which,y,T,D,E,I=!1,k=o.keyMap[t.keyCode]||"",N,P=1===p.length&&0===g.length;if(!r.is("input:focus, select:focus, textarea:focus, button:focus")){switch(r.is("."+n.hoverClass+":tabbable")&&$("html").off("keydown.accessible-megamenu"),x){case o.ESCAPE:f.call(a,t,!0);break;case o.DOWN:t.preventDefault(),P?(f.call(a,t),I=1===p.find("."+n.panelClass+" :tabbable:first").focus().length):I=1===m.filter(":gt("+m.index(r)+"):first").focus().length,!I&&e.opera&&"[object Opera]"===opera.toString()&&(t.ctrlKey||t.metaKey)&&(m=$(":tabbable"),T=m.index(r),I=1===$(":tabbable:gt("+$(":tabbable").index(r)+"):first").focus().length);break;case o.UP:t.preventDefault(),P&&r.hasClass(n.openClass)?(f.call(a,t,!0),v=d.filter(":lt("+d.index(p)+"):last"),v.children("."+n.panelClass).length&&(I=1===v.children().attr("aria-expanded","true").addClass(n.openClass).filter("."+n.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):P||(I=1===m.filter(":lt("+m.index(r)+"):last").focus().length),!I&&e.opera&&"[object Opera]"===opera.toString()&&(t.ctrlKey||t.metaKey)&&(m=$(":tabbable"),T=m.index(r),I=1===$(":tabbable:lt("+$(":tabbable").index(r)+"):first").focus().length);break;case o.RIGHT:t.preventDefault(),P?I=1===d.filter(":gt("+d.index(p)+"):first").find(":tabbable:first").focus().length:(b.length&&C.length&&(I=1===b.filter(":gt("+b.index(C)+"):first").find(":tabbable:first").focus().length),I||(I=1===p.find(":tabbable:first").focus().length));break;case o.LEFT:t.preventDefault(),P?I=1===d.filter(":lt("+d.index(p)+"):last").find(":tabbable:first").focus().length:(b.length&&C.length&&(I=1===b.filter(":lt("+b.index(C)+"):last").find(":tabbable:first").focus().length),I||(I=1===p.find(":tabbable:first").focus().length));break;case o.TAB:T=m.index(r),t.shiftKey&&P&&r.hasClass(n.openClass)?(f.call(a,t,!0),v=d.filter(":lt("+d.index(p)+"):last"),v.children("."+n.panelClass).length&&(I=v.children().attr("aria-expanded","true").addClass(n.openClass).filter("."+n.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):t.shiftKey&&T>0?I=1===m.filter(":lt("+T+"):last").focus().length:!t.shiftKey&&T<m.length-1?I=1===m.filter(":gt("+T+"):first").focus().length:e.opera&&"[object Opera]"===opera.toString()&&(m=$(":tabbable"),T=m.index(r),I=t.shiftKey?1===$(":tabbable:lt("+$(":tabbable").index(r)+"):last").focus().length:1===$(":tabbable:gt("+$(":tabbable").index(r)+"):first").focus().length),I&&t.preventDefault();break;case o.SPACE:if(!P)return!0;t.preventDefault(),h.call(a,t);break;case o.ENTER:return!0;break;default:if(clearTimeout(this.keydownTimeoutID),l+=k!==l?k:"",0===l.length)return;for(this.keydownTimeoutID=setTimeout(function(){l=""},i),m=P&&!r.hasClass(n.openClass)?m.filter(":not(."+n.panelClass+" :tabbable)"):p.find(":tabbable"),t.shiftKey&&(m=$(m.get().reverse())),T=0;T<m.length;T++)if(D=m.eq(T),D.is(r)){y=1===l.length?T+1:T;break}for(N=new RegExp("^"+l.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),"i"),T=y;T<m.length;T++)if(D=m.eq(T),E=$.trim(D.text()),N.test(E)){I=!0,D.focus();break}if(!I)for(T=0;y>T;T++)if(D=m.eq(T),E=$.trim(D.text()),N.test(E)){D.focus();break}}a.justFocused=!1}},C=function(e){($(e.target).is(this.settings.panelClass)||$(e.target).closest(":focusable").length)&&(this.mouseFocused=!0),this.mouseTimeoutID=setTimeout(function(){clearTimeout(this.focusTimeoutID)},1)},v=function(e){clearTimeout(this.mouseTimeoutID),$(e.target).addClass(this.settings.hoverClass),f.call(this,e),$(e.target).is(":tabbable")&&$("html").on("keydown.accessible-megamenu",$.proxy(b,e.target))},x=function(e){var t=this;$(e.target).removeClass(t.settings.hoverClass),t.mouseTimeoutID=setTimeout(function(){f.call(t,e,!0)},250),$(e.target).is(":tabbable")&&$("html").off("keydown.accessible-megamenu")},y=function(e){var t=this.menu;e?($("html").off("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu"),t.find("[aria-expanded]."+this.settings.panelClass).off("DOMAttrModified.accessible-megamenu")):($("html").on("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu",$.proxy(d,this)),t.find("[aria-expanded=true]."+this.settings.panelClass).on("DOMAttrModified.accessible-megamenu",$.proxy(p,this)))},{constructor:s,init:function(){var e=this.settings,t=$(this.element),s=this.menu=t.find(e.menuSelector).first(),a=s.children();this.start(e,t,s,a)},start:function(e,s,a,i){var n=this;this.settings=e,this.menu=a,this.topnavitems=i,s.attr("role","navigation"),a.addClass(e.menuClass),i.each(function(t,s){var a,i;s=$(s),s.addClass(e.topNavItemClass),a=s.find(":tabbable:first"),i=s.children(":not(:tabbable):last"),c.call(n,a),i.length&&(c.call(n,i),a.attr({"aria-haspopup":!0,"aria-controls":i.attr("id"),"aria-expanded":!1}),i.attr({role:"group","aria-expanded":!1,"aria-hidden":!0}).addClass(e.panelClass).not("[aria-labelledby]").attr("aria-labelledby",a.attr("id")))}),this.panels=a.find("."+e.panelClass),a.on("focusin.accessible-megamenu",":focusable, ."+e.panelClass,$.proxy(m,this)).on("focusout.accessible-megamenu",":focusable, ."+e.panelClass,$.proxy(g,this)).on("keydown.accessible-megamenu",$.proxy(b,this)).on("mouseover.accessible-megamenu",$.proxy(v,this)).on("mouseout.accessible-megamenu",$.proxy(x,this)).on("mousedown.accessible-megamenu",$.proxy(C,this)),r&&a.on(e.tapEvent+".accessible-megamenu",$.proxy(h,this)),a.find("hr").attr("role","separator"),$(t.activeElement).closest(a).length&&$(t.activeElement).trigger("focusin.accessible-megamenu")},getDefaults:function(){return this._defaults},getOption:function(e){return this.settings[e]},getAllOptions:function(){return this.settings},setOption:function(e,t,s){this.settings[e]=t,s&&this.init()}}}(),$.fn[n]=function(e){return this.each(function(){$.data(this,"plugin_"+n)||$.data(this,"plugin_"+n,new $.fn[n].AccessibleMegaMenu(this,e))})},$.fn[n].AccessibleMegaMenu=s,$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(e){return function(t){return!!$.data(t,e)}}):function(e,t,s){return!!$.data(e,s[3])},focusable:function(e){return i(e,!isNaN($.attr(e,"tabindex")))},tabbable:function(e){var t=$.attr(e,"tabindex"),s=isNaN(t);return(s||t>=0)&&i(e,!s)}})}(jQuery,window,document);